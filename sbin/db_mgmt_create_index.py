#!/usr/bin/env python3
# -*- coding: utf-8 -*-
#
# Script to check and ensure that the recommended index are created as recommended.
#
# Software is free software released under the "GNU Affero General Public License v3.0"
#
# Copyright (c) 2014       psychedelys
# Copyright (c) 2015-2109  Pieter-Jan Moreels - pieter-jan@pidgey.net

# Imports
import os
import sys
runPath = os.path.dirname(os.path.realpath(__file__))
sys.path.append(os.path.join(runPath, ".."))

from pymongo import TEXT

from lib.DatabaseLayer import DatabaseLayer

db = DatabaseLayer()

def setIndex(col, field, printSuccess = True):
    try:
        db.ensure_index(col, field)
        if printSuccess:
            print(f'[+]Success to create index {field} on {col}')
    except Exception as e:
        print(f'[-]Failed to create index {col} on {field}: {e}')

setIndex('cpe', 'id')
setIndex('cpeother', 'id')
setIndex('cves', 'id')
setIndex('cves', 'vulnerable_configuration')
setIndex('cves', 'Modified')
setIndex('cves', 'Published')
setIndex('cves', [("summary",TEXT)])
setIndex('via4', 'id')
setIndex('capec', 'related_weakness')

for index in db.VIA4.searchables():
    setIndex('via4', index, False)
